<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hospital OP Chart</title>
</head>
<body>
  <h1>Hospital OP Status for <span id="current-date"></span></h1>
  <p>Last Updated: <span id="last-updated"></span></p>
  <div id="op-chart"></div>

  <script>
    // Function to display the current date
    function displayCurrentDate() {
      const currentDate = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById("current-date").textContent = currentDate.toLocaleDateString(undefined, options);
    }

    // Function to fetch OP statuses and last updated time
    async function fetchOPStatuses() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbwqAeABNfct8-oMNyqILDh9Hm0hRanpONCnCHoq3y27i5CustS_HHOPNsGz3a0JD7qX/exec'); // Replace with your Apps Script URL
        const data = await response.json();
        const opData = data.opData;
        const lastUpdated = new Date(data.lastUpdated);
        const opChartElement = document.getElementById("op-chart");

        opChartElement.innerHTML = ""; // Clear existing data

        // Display OP data
        opData.forEach(op => {
          const opDiv = document.createElement("div");
          opDiv.style.marginBottom = "10px";

          opDiv.innerHTML = `
            <strong>${op.opName}</strong><br>
            <strong>Status:</strong> <span style="color:${op.opStatus.toLowerCase() === "yes" ? "green" : "red"};">
              ${op.opStatus.toLowerCase() === "yes" ? "OP is available" : "OP is not available"}
            </span>
          `;
          
          opChartElement.appendChild(opDiv);
        });

        // Display last updated time
        const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
        document.getElementById("last-updated").textContent = lastUpdated.toLocaleDateString(undefined, options);

      } catch (error) {
        console.error("Error fetching OP statuses:", error);
      }
    }

    displayCurrentDate(); // Show the current date
    fetchOPStatuses(); // Fetch OP statuses and last updated time
    setInterval(fetchOPStatuses, 60000); // Update every 60 seconds
  </script>
</body>
</html>
